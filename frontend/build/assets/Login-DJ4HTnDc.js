import{r as c,j as e,L as S,G as I,a as g}from"./index-Mo7RvhfR.js";/* empty css              */function P(l){const i=l.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(i).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(s)}const T=()=>{const[l,u]=c.useState({username:"",password:""}),[i,s]=c.useState({message:"",type:""}),[d,p]=c.useState(!1),[E,L]=c.useState(!1),[m,k]=c.useState(""),h=t=>{u({...l,[t.target.name]:t.target.value})},F=async t=>{var r,n,o,y,f,x,j,b,w,v,N;t.preventDefault(),p(!0);try{const a=await g.post("/auth/login/",{username:l.username,password:l.password});if(console.log("Login response:",a.data),a.data.access&&a.data.refresh)localStorage.setItem("access_token",a.data.access),localStorage.setItem("refresh_token",a.data.refresh),s({message:"Logged in successfully",type:"success"}),window.location.href="/";else throw new Error("Invalid response format: access or refresh token missing")}catch(a){console.error("Login error:",((r=a.response)==null?void 0:r.data)||a.message),(y=(o=(n=a.response)==null?void 0:n.data)==null?void 0:o.non_field_errors)!=null&&y.includes("No active account found with the given credentials")||((x=(f=a.response)==null?void 0:f.data)==null?void 0:x.detail)==="No active account found with the given credentials"?(s({message:"Your account is not activated. Please check your email or resend the activation link.",type:"danger"}),L(!0)):s({message:((w=(b=(j=a.response)==null?void 0:j.data)==null?void 0:b.non_field_errors)==null?void 0:w[0])||((N=(v=a.response)==null?void 0:v.data)==null?void 0:N.detail)||"Login failed. Please check your credentials.",type:"danger"}),setTimeout(()=>s({message:"",type:""}),5e3)}finally{p(!1)}},_=async()=>{var t,r;if(!m){s({message:"Please enter your email address.",type:"danger"}),setTimeout(()=>s({message:"",type:""}),5e3);return}try{await g.post("/resend-activation/",{email:m}),s({message:"Activation email resent successfully.",type:"success"}),setTimeout(()=>s({message:"",type:""}),5e3)}catch(n){s({message:((r=(t=n.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to resend activation email.",type:"danger"}),setTimeout(()=>s({message:"",type:""}),5e3)}};return e.jsx(e.Fragment,{children:e.jsx("section",{className:"login",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"card shadow my-login-card-style",style:{borderRadius:20},children:[e.jsx("div",{className:"column-1",children:e.jsx("img",{src:"/Frame2.png",alt:"login page image"})}),e.jsxs("div",{className:"card-body column-2",children:[e.jsx("h4",{className:"text-center mb-2",children:"Welcome"}),e.jsx("p",{className:"text-center text-secondary mb-4",children:"Please login to your account"}),i.message&&e.jsx("div",{className:`alert alert-${i.type}`,role:"alert",children:i.message}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"text",id:"username",name:"username",className:"form-control",placeholder:"username",required:!0,onChange:h}),e.jsx("label",{htmlFor:"username",children:"username"})]}),e.jsxs("div",{className:"form-floating mb-4",children:[e.jsx("input",{type:"password",id:"password",name:"password",className:"form-control",placeholder:"Password",required:!0,onChange:h}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsx(S,{to:"/forgot-password",className:"text-secondary",children:"Forgot Password?"})}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100 mb-3",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Logging in..."]}):"Login"}),E&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"form-floating mb-2",children:[e.jsx("input",{type:"email",id:"resendEmail",name:"resendEmail",className:"form-control",placeholder:"Email",value:m,onChange:t=>k(t.target.value)}),e.jsx("label",{htmlFor:"resendEmail",children:"Email"})]}),e.jsx("button",{type:"button",className:"btn btn-secondary w-100",onClick:_,children:"Resend Activation Email"})]}),e.jsx("div",{className:"google-login justify-content-center mb-3 w-100",children:e.jsx(I,{onSuccess:async t=>{const{credential:r}=t;if(r){const n=P(r);try{const o=await g.post("/google-login/",{email:n.email,name:n.name});localStorage.setItem("access_token",o.data.access),localStorage.setItem("refresh_token",o.data.refresh),s({message:"Logged in successfully",type:"success"}),setTimeout(()=>s({message:"",type:""}),5e3),window.location.href="/"}catch(o){console.error("Google login error",o),s({message:"Google login failed.",type:"danger"}),setTimeout(()=>s({message:"",type:""}),5e3)}}},onError:()=>{s({message:"Google login error",type:"danger"})}})}),e.jsxs("p",{className:"text-center mt-3 mb-0",children:["Donâ€™t have an account?"," ",e.jsx(S,{to:"/register",children:"Sign Up"})]})]})]})]})})})})};export{T as default};
