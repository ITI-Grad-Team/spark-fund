import{e as V,r as a,a as d,j as e}from"./index-Mo7RvhfR.js";import{C as L}from"./CampaignSmallCard-Bzd6GahR.js";import{F as W}from"./Footer-Cdlub8S1.js";function se(){const{id:l}=V(),[n,y]=a.useState(null),[S,M]=a.useState([]),[g,B]=a.useState([]),[O,b]=a.useState(!1),[t,c]=a.useState({}),[v,Y]=a.useState(""),[q,P]=a.useState(!1),[m,N]=a.useState("profile"),[z,k]=a.useState([]),[h,D]=a.useState(!1),[F,p]=a.useState(""),[_,E]=a.useState(!1),j=localStorage.getItem("user_id"),[$,I]=a.useState(""),[T,U]=a.useState(""),[x,w]=a.useState(""),[f,C]=a.useState(""),[G,R]=a.useState(!1),[H,A]=a.useState(!1);a.useEffect(()=>{d.get(`/customuser/${l}/`).then(s=>{console.log("User data:",s.data),y(s.data),c(s.data)}),d.get(`/projects/?project_creator=${l}`).then(s=>{M(s.data)}),d.get("my-donations/").then(async s=>{B(s.data);const r=[...new Set(s.data.map(o=>o.project))];if(r.length>0)try{const o=[];for(const i of r)try{const u=await d.get(`/projects/${i}/`);o.push(u.data),console.log(`Fetched project ${i}:`,u.data)}catch(u){console.error(`Error fetching project ${i}:`,u)}k(o)}catch(o){console.error("Error fetching donation projects:",o)}else k([])})},[l]),a.useEffect(()=>{if(f||x){const s=setTimeout(()=>{C(""),w("")},3e3);return()=>clearTimeout(s)}},[f,x]);const J=()=>{const s=new FormData;for(let r in t)t[r]!==null&&t[r]!==void 0&&s.append(r,t[r]);A(!0),d.patch(`/update-user/${l}/`,s,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{y(r.data),b(!1),A(!1)})},K=()=>{D(!0),p(""),E(!1),d.patch(`/update-user/${l}/`,{is_deleted:!0,password:v}).then(()=>{E(!0),setTimeout(()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login"},1500)}).catch(s=>{s.response&&s.response.data?p(s.response.data.detail):p("Something went wrong. Please try again.")}).finally(()=>{D(!1)})},Q=()=>{R(!0),d.post("/change-password/",{current_password:$,new_password:T}).then(s=>{C(s.data.detail),w(""),I(""),U("")}).catch(s=>{var r,o;w(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.detail)||"Error changing password"),C("")}).finally(()=>{R(!1)})};return n?e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"container my-5",children:[e.jsx("h2",{className:"mb-4",children:"User Profile"}),e.jsxs("ul",{className:"nav nav-tabs mb-4",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${m==="profile"?"active":""}`,onClick:()=>N("profile"),children:"Profile"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${m==="projects"?"active":""}`,onClick:()=>N("projects"),children:"Projects"})}),j===l&&e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${m==="donations"?"active":""}`,onClick:()=>N("donations"),children:"Donations"})})]}),m==="profile"&&e.jsxs("div",{className:"card p-4",children:[O?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-center",children:[e.jsx("label",{htmlFor:"profileImage",style:{cursor:"pointer"},children:e.jsx("img",{src:t.profile_picture instanceof File?URL.createObjectURL(t.profile_picture):(n==null?void 0:n.profile_picture)||"/profile-blank.png",alt:"Profile Preview",className:"rounded-circle mb-2",width:"150"})}),e.jsx("input",{type:"file",id:"profileImage",accept:"image/*",className:"form-control mt-2",style:{display:"none"},onChange:s=>c({...t,profile_picture:s.target.files[0]})})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("input",{className:"form-control",value:t.username||"",onChange:s=>c({...t,username:s.target.value}),placeholder:"Username"})}),e.jsx("div",{className:"col-md-6",children:e.jsx("input",{className:"form-control",value:t.phone||"",onChange:s=>c({...t,phone:s.target.value}),placeholder:"Phone"})})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("input",{className:"form-control",type:"date",value:t.birth_date||"",onChange:s=>c({...t,birth_date:s.target.value})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("input",{className:"form-control",value:t.facebook_profile||"",onChange:s=>c({...t,facebook_profile:s.target.value}),placeholder:"Facebook URL"})})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{className:"form-control",value:t.country||"",onChange:s=>c({...t,country:s.target.value}),placeholder:"Country"})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:J,children:H?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):"Save"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>b(!1),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Username:"})," ",n.username]}),e.jsxs("p",{children:[e.jsx("b",{children:"Email:"})," ",n.email]}),e.jsxs("p",{children:[e.jsx("b",{children:"Phone:"})," ",n.phone]}),e.jsxs("p",{children:[e.jsx("b",{children:"Birthdate:"})," ",n.birth_date||" "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Facebook:"})," ",e.jsx("a",{href:n.facebook_profile,children:n.facebook_profile||" "})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Country:"})," ",n.country||" "]})]}),e.jsx("div",{className:"col-md-4 text-center",children:e.jsx("img",{src:(n==null?void 0:n.profile_picture)||"/profile-blank.png",onError:s=>{s.target.onerror=null,s.target.src="/profile-blank.png"},alt:"Profile",className:"rounded-circle",width:"150"})})]}),j===l&&e.jsx("button",{className:"btn btn-outline-primary mb-3",onClick:()=>b(!0),children:"Edit Profile"})]}),j===l&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("h5",{children:"Change Password"}),e.jsx("input",{type:"password",className:"form-control mb-2",placeholder:"Current password",value:$,onChange:s=>I(s.target.value)}),e.jsx("input",{type:"password",className:"form-control mb-2",placeholder:"New password",value:T,onChange:s=>U(s.target.value)}),e.jsx("button",{className:"btn btn-outline-primary",onClick:Q,children:G?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Changing..."]}):"Change Password"}),x&&e.jsx("div",{className:"alert alert-danger mt-2",children:x}),f&&e.jsx("div",{className:"alert alert-success mt-2",children:f})]}),j===l&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("h5",{children:"Delete Account"}),e.jsx("input",{type:"password",className:"form-control mb-2",placeholder:"Enter password to confirm",value:v,onChange:s=>Y(s.target.value),disabled:h}),e.jsx("button",{className:"btn btn-danger",onClick:()=>P(!0),disabled:!v||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Deleting..."]}):"Delete Account"})]}),F&&(setTimeout(()=>p(""),5e3),e.jsx("div",{className:"alert alert-danger mt-3",children:F})),_&&e.jsx("div",{className:"alert alert-success mt-3",children:"Account deleted successfully. Redirecting..."}),q&&!_&&e.jsxs("div",{className:"alert alert-warning mt-3",children:[e.jsx("p",{children:"Are you sure you want to delete your account?"}),e.jsx("button",{className:"btn btn-danger me-2",onClick:K,disabled:h,children:h?"Deleting...":"Yes, delete"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>P(!1),disabled:h,children:"Cancel"})]})]}),m==="projects"&&e.jsx("div",{className:"row",children:S.length>0?S.map(s=>e.jsx("div",{className:"col-md-4 mb-4",children:e.jsx(L,{project:s})},s.id)):e.jsx("div",{className:"col-12",children:e.jsx("p",{children:"No projects found."})})}),m==="donations"&&e.jsx("div",{children:g.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row",children:z.map(s=>{const o=g.filter(i=>i.project===s.id).reduce((i,u)=>i+parseFloat(u.amount),0);return e.jsxs("div",{className:"col-md-4 mb-4",children:[e.jsx(L,{project:s}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Total donated:"})," $",o.toFixed(2)]})})]},s.id)})}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{children:"Donation Summary"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total donated to all projects:"})," $",g.reduce((s,r)=>s+parseFloat(r.amount),0).toFixed(2)]})]})]}):e.jsx("p",{children:"No donations found."})})]}),e.jsx(W,{})]}):e.jsx("div",{className:"text-center my-5",children:"Loading..."})}export{se as default};
